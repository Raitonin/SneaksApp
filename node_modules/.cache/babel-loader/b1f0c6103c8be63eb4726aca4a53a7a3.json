{"ast":null,"code":"const got = require('got');\n\nmodule.exports = {\n  getLink: async function (shoe, callback) {\n    try {\n      const response = await got.post('https://2fwotdvm2o-dsn.algolia.net/1/indexes/*/queries?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%20(lite)%203.25.1%3Breact%20(16.9.0)%3Breact-instantsearch%20(6.2.0)%3BJS%20Helper%20(3.1.0)&x-algolia-application-id=2FWOTDVM2O&x-algolia-api-key=ac96de6fef0e02bb95d433d8d5c7038a', {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n          'Content-Type': 'application/json'\n        },\n        body: '{\"requests\":[{\"indexName\":\"product_variants_v2\",\"params\":\"distinct=true&maxValuesPerFacet=1&page=0&query=' + shoe.styleID + '&facets=%5B%22instant_ship_lowest_price_cents\"}]}',\n        http2: true\n      });\n      var json = JSON.parse(response.body);\n\n      if (json.results[0].hits[0]) {\n        if (json.results[0].hits[0].lowest_price_cents_usd / 100 != 0) {\n          shoe.lowestResellPrice.goat = json.results[0].hits[0].lowest_price_cents_usd / 100;\n        }\n\n        shoe.resellLinks.goat = 'https://www.goat.com/sneakers/' + json.results[0].hits[0].slug;\n      }\n\n      callback();\n    } catch (error) {\n      let err = new Error(\"Could not connect to Goat while searching '\" + shoe.styleID + \"' Error: \", error);\n      console.log(err);\n      callback(err);\n    }\n  },\n  getPrices: async function (shoe, callback) {\n    if (!shoe.resellLinks.goat) {\n      callback();\n    } else {\n      let apiLink = shoe.resellLinks.goat.replace('sneakers/', 'web-api/v1/product_variants?productTemplateId=');\n      let priceMap = {};\n\n      try {\n        const response = await got(apiLink, {\n          headers: {\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n            'Content-Type': 'application/json'\n          },\n          http2: true\n        });\n        var json = JSON.parse(response.body);\n\n        for (var i = 0; i < json.length; i++) {\n          if (json[i].shoeCondition == 'used') continue;\n\n          if (priceMap[json[i].size]) {\n            priceMap[json[i].size] = json[i].lowestPriceCents.amount / 100 < priceMap[json[i].size] ? json[i].lowestPriceCents.amount / 100 : priceMap[json[i].size];\n          } else {\n            priceMap[json[i].size] = json[i].lowestPriceCents.amount / 100;\n          }\n        }\n\n        shoe.resellPrices.goat = priceMap;\n        callback();\n      } catch (error) {\n        let err = new Error(\"Could not connect to Goat while searching '\" + shoe.styleID + \"' Error: \", error);\n        console.log(err);\n        callback(err);\n      }\n    }\n  },\n  getPictures: async function (shoe, callback) {\n    if (!shoe.resellLinks.goat) {\n      callback();\n    } else {\n      let apiLink = shoe.resellLinks.goat.replace('sneakers', 'web-api/v1/product_templates');\n\n      try {\n        const response = await got(apiLink, {\n          headers: {\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n            'Content-Type': 'application/json'\n          },\n          http2: true\n        });\n        var json = JSON.parse(response.body);\n\n        if (json.productTemplateExternalPictures) {\n          if (json.productTemplateExternalPictures[0]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[0].mainPictureUrl);\n          }\n\n          if (json.productTemplateExternalPictures[2]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[2].mainPictureUrl);\n          }\n\n          if (json.productTemplateExternalPictures[5]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[5].mainPictureUrl);\n          }\n\n          if (json.productTemplateExternalPictures[7]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[7].mainPictureUrl);\n          }\n\n          if (json.productTemplateExternalPictures[3]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[3].mainPictureUrl);\n          }\n        }\n\n        callback(shoe);\n      } catch (error) {\n        let err = new Error(\"Could not connect to Goat while grabbing pictures for '\" + shoe.styleID + \"' Error: \", error);\n        console.log(err);\n        callback(err);\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/Users/dhruv/Sneaks/sneaks-website/node_modules/sneaks-api/scrapers/goat-scraper.js"],"names":["got","require","module","exports","getLink","shoe","callback","response","post","headers","body","styleID","http2","json","JSON","parse","results","hits","lowest_price_cents_usd","lowestResellPrice","goat","resellLinks","slug","error","err","Error","console","log","getPrices","apiLink","replace","priceMap","i","length","shoeCondition","size","lowestPriceCents","amount","resellPrices","getPictures","productTemplateExternalPictures","imageLinks","push","mainPictureUrl"],"mappings":"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","sourcesContent":["const got = require('got');\n\n\nmodule.exports = {\n  getLink: async function (shoe, callback) {\n    try {\n      const response = await got.post('https://2fwotdvm2o-dsn.algolia.net/1/indexes/*/queries?x-algolia-agent=Algolia%20for%20vanilla%20JavaScript%20(lite)%203.25.1%3Breact%20(16.9.0)%3Breact-instantsearch%20(6.2.0)%3BJS%20Helper%20(3.1.0)&x-algolia-application-id=2FWOTDVM2O&x-algolia-api-key=ac96de6fef0e02bb95d433d8d5c7038a', {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n          'Content-Type': 'application/json'\n        },\n        body: '{\"requests\":[{\"indexName\":\"product_variants_v2\",\"params\":\"distinct=true&maxValuesPerFacet=1&page=0&query=' + shoe.styleID + '&facets=%5B%22instant_ship_lowest_price_cents\"}]}',\n        http2: true,\n      });\n      var json = JSON.parse(response.body);\n      if (json.results[0].hits[0]) {\n        if (json.results[0].hits[0].lowest_price_cents_usd / 100 != 0) {\n          shoe.lowestResellPrice.goat = json.results[0].hits[0].lowest_price_cents_usd / 100;\n        }\n        shoe.resellLinks.goat = 'https://www.goat.com/sneakers/' + json.results[0].hits[0].slug;\n      }\n      callback();\n    } catch (error) {\n      let err = new Error(\"Could not connect to Goat while searching '\" + shoe.styleID + \"' Error: \", error)\n      console.log(err);\n      callback(err)\n    }\n  },\n\n  getPrices: async function (shoe, callback) {\n    if (!shoe.resellLinks.goat) {\n      callback()\n    } else {\n      let apiLink = shoe.resellLinks.goat.replace('sneakers/', 'web-api/v1/product_variants?productTemplateId=');\n      let priceMap = {};\n      try {\n        const response = await got(apiLink, {\n          headers: {\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n            'Content-Type': 'application/json'\n          },\n          http2: true,\n        });\n        var json = JSON.parse(response.body);\n        for (var i = 0; i < json.length; i++) {\n          if(json[i].shoeCondition == 'used') continue;\n          if(priceMap[json[i].size]){\n            priceMap[json[i].size] = json[i].lowestPriceCents.amount / 100 < priceMap[json[i].size] ? json[i].lowestPriceCents.amount / 100 : priceMap[json[i].size];\n          }\n          else{\n            priceMap[json[i].size] = json[i].lowestPriceCents.amount / 100 ;\n          }\n\n          \n        }\n        shoe.resellPrices.goat = priceMap;\n        callback()\n      } catch (error) {\n        let err = new Error(\"Could not connect to Goat while searching '\" + shoe.styleID + \"' Error: \", error)\n        console.log(err);\n        callback(err)\n      }\n    }\n  },\n\n  getPictures: async function (shoe, callback) {\n    if (!shoe.resellLinks.goat) {\n      callback()\n    } else {\n      let apiLink = shoe.resellLinks.goat.replace('sneakers', 'web-api/v1/product_templates');\n      try {\n        const response = await got(apiLink, {\n          headers: {\n            'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n            'Content-Type': 'application/json'\n          },\n          http2: true,\n        });\n        var json = JSON.parse(response.body);\n        if (json.productTemplateExternalPictures) {\n          if (json.productTemplateExternalPictures[0]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[0].mainPictureUrl);\n          }\n          if (json.productTemplateExternalPictures[2]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[2].mainPictureUrl);\n          }\n          if (json.productTemplateExternalPictures[5]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[5].mainPictureUrl);\n          }\n          if (json.productTemplateExternalPictures[7]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[7].mainPictureUrl);\n          }\n          if (json.productTemplateExternalPictures[3]) {\n            shoe.imageLinks.push(json.productTemplateExternalPictures[3].mainPictureUrl);\n          }\n        }\n        callback(shoe);\n      } catch (error) {\n        let err = new Error(\"Could not connect to Goat while grabbing pictures for '\" + shoe.styleID + \"' Error: \", error)\n        console.log(err);\n        callback(err)\n      }\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"script"}
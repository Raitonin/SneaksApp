{"ast":null,"code":"const Sneaker = require('../models/Sneaker');\n\nconst stockXScraper = require('../scrapers/stockx-scraper');\n\nconst flightClubScraper = require('../scrapers/flightclub-scraper');\n\nconst goatScraper = require('../scrapers/goat-scraper');\n\nconst stadiumGoodsScraper = require('../scrapers/stadiumgoods-scraper');\n\nmodule.exports = class Sneaks {\n  findOne(shoeID, callback) {\n    Sneaker.findOne({\n      styleID: shoeID\n    }, function (err, shoe) {\n      if (err) {\n        console.log(err);\n        callback(err, null);\n      }\n\n      callback(null, shoe);\n    });\n  }\n\n  /*exports.create = async function (req, res) {\n    if (!req.params) {\n      return res.status(400).send({\n        message: \"Shoe parameters can not be empty\"\n      });\n    }\n    getProducts(req.params.shoe, function (error, products) {\n      if (error) {\n         console.log(error)\n        res.send(\"Product Not Found\");\n      } else {\n        res.json(products);\n      }\n    });\n  };*/\n  async getProducts(keyword, callback) {\n    var productCounter = 0;\n    stockXScraper.getProductsAndInfo(keyword, function (error, products) {\n      if (error) {\n        callback(error, null);\n      }\n\n      products.forEach(function (shoe) {\n        var cbCounter = 0;\n        flightClubScraper.getLink(shoe, function () {\n          if (++cbCounter == 3) {\n            Sneaker.countDocuments({\n              styleID: shoe.styleID\n            }, function (err, count) {\n              if (count <= 0) {\n                shoe.save();\n              } //if all shoes links have been parsed then return\n\n\n              if (productCounter++ + 1 == products.length) {\n                callback(null, products);\n              }\n            });\n          }\n        });\n        stadiumGoodsScraper.getLink(shoe, function () {\n          if (++cbCounter == 3) {\n            Sneaker.countDocuments({\n              styleID: shoe.styleID\n            }, function (err, count) {\n              if (count <= 0) {\n                shoe.save();\n              } //if all shoes links have been parsed then return\n\n\n              if (productCounter++ + 1 == products.length) {\n                callback(null, products);\n              }\n            });\n          }\n        });\n        goatScraper.getLink(shoe, function () {\n          if (++cbCounter == 3) {\n            Sneaker.countDocuments({\n              styleID: shoe.styleID\n            }, function (err, count) {\n              if (count <= 0) {\n                shoe.save();\n              } //if all shoes links have been parsed then return\n\n\n              if (productCounter++ + 1 == products.length) {\n                callback(null, products);\n              }\n            });\n          }\n        });\n      });\n    });\n  }\n\n  getProductPrices(shoeID, callback) {\n    const getPrices = shoe => {\n      var cbCounter = 0;\n      stockXScraper.getPrices(shoe, function () {\n        cbCounter++;\n\n        if (cbCounter == 5) {\n          callback(null, shoe);\n        }\n      });\n      stadiumGoodsScraper.getPrices(shoe, function () {\n        cbCounter++;\n\n        if (cbCounter == 5) {\n          callback(null, shoe);\n        }\n      });\n      flightClubScraper.getPrices(shoe, function () {\n        cbCounter++;\n\n        if (cbCounter == 5) {\n          callback(null, shoe);\n        }\n      });\n      goatScraper.getPrices(shoe, function () {\n        cbCounter++;\n\n        if (cbCounter == 5) {\n          callback(null, shoe);\n        }\n      });\n      goatScraper.getPictures(shoe, function () {\n        cbCounter++;\n\n        if (cbCounter == 5) {\n          callback(null, shoe);\n        }\n      });\n    };\n\n    Sneaker.findOne({\n      styleID: shoeID\n    }, function (err, shoe) {\n      if (!shoe || err) {\n        console.log(new Error(\"Sneaker not found in database\"));\n        getProducts(shoeID, function (error, products) {\n          if (error) {\n            console.log(new Error(\"No Products Found\"));\n            callback(error, null);\n            return;\n          }\n\n          getPrices(products[0]);\n        });\n      } else {\n        getPrices(shoe);\n      }\n    });\n  }\n\n  findAll(callback) {\n    Sneaker.find().then(sneaks => {\n      callback(null, sneaks);\n    }).catch(err => {\n      callback(err, null);\n    });\n  }\n\n  getMostPopular(callback) {\n    getProducts(\"\", function (error, products) {\n      if (error) {\n        callback(error, null);\n      } else {\n        callback(null, products);\n      }\n    });\n  }\n\n};\n\nvar getProducts = function (keyword, callback) {\n  var productCounter = 0;\n  stockXScraper.getProductsAndInfo(keyword, function (error, products) {\n    if (error) {\n      callback(error, null);\n    }\n\n    products.forEach(function (shoe) {\n      var cbCounter = 0;\n      flightClubScraper.getLink(shoe, function () {\n        if (++cbCounter == 3) {\n          Sneaker.countDocuments({\n            styleID: shoe.styleID\n          }, function (err, count) {\n            if (count <= 0) {\n              shoe.save();\n            } //if all shoes links have been parsed then return\n\n\n            if (productCounter++ + 1 == products.length) {\n              callback(null, products);\n            }\n          });\n        }\n      });\n      stadiumGoodsScraper.getLink(shoe, function () {\n        if (++cbCounter == 3) {\n          Sneaker.countDocuments({\n            styleID: shoe.styleID\n          }, function (err, count) {\n            if (count <= 0) {\n              shoe.save();\n            } //if all shoes links have been parsed then return\n\n\n            if (productCounter++ + 1 == products.length) {\n              callback(null, products);\n            }\n          });\n        }\n      });\n      goatScraper.getLink(shoe, function () {\n        if (++cbCounter == 3) {\n          Sneaker.countDocuments({\n            styleID: shoe.styleID\n          }, function (err, count) {\n            if (count <= 0) {\n              shoe.save();\n            } //if all shoes links have been parsed then return\n\n\n            if (productCounter++ + 1 == products.length) {\n              callback(null, products);\n            }\n          });\n        }\n      });\n    });\n  });\n};","map":{"version":3,"sources":["/Users/dhruv/Sneaks/sneaks-website/node_modules/sneaks-api/controllers/sneaks.controllers.js"],"names":["Sneaker","require","stockXScraper","flightClubScraper","goatScraper","stadiumGoodsScraper","module","exports","Sneaks","findOne","shoeID","callback","styleID","err","shoe","console","log","getProducts","keyword","productCounter","getProductsAndInfo","error","products","forEach","cbCounter","getLink","countDocuments","count","save","length","getProductPrices","getPrices","getPictures","Error","findAll","find","then","sneaks","catch","getMostPopular"],"mappings":"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","sourcesContent":["const Sneaker = require('../models/Sneaker');\nconst stockXScraper = require('../scrapers/stockx-scraper');\nconst flightClubScraper = require('../scrapers/flightclub-scraper');\nconst goatScraper = require('../scrapers/goat-scraper');\nconst stadiumGoodsScraper = require('../scrapers/stadiumgoods-scraper');\n\nmodule.exports = class Sneaks {\n  findOne (shoeID, callback) {\n    Sneaker.findOne({\n      styleID: shoeID\n    }, function (err, shoe) {\n      if (err) {\n        console.log(err);\n        callback(err, null);\n      }\n      callback(null, shoe)\n    });\n  };\n\n  /*exports.create = async function (req, res) {\n    if (!req.params) {\n      return res.status(400).send({\n        message: \"Shoe parameters can not be empty\"\n      });\n    }\n    getProducts(req.params.shoe, function (error, products) {\n      if (error) {\n\n        console.log(error)\n        res.send(\"Product Not Found\");\n      } else {\n        res.json(products);\n      }\n    });\n  };*/\n async getProducts  (keyword, callback) {\n\n    var productCounter = 0;\n    stockXScraper.getProductsAndInfo(keyword, function (error, products) {\n      if (error) {\n        callback(error, null)\n      }\n      products.forEach(function (shoe) {\n        var cbCounter = 0;\n        flightClubScraper.getLink(shoe, function () {\n          if (++cbCounter == 3) {\n            Sneaker.countDocuments({\n              styleID: shoe.styleID\n            }, function (err, count) {\n              if (count <= 0) {\n                shoe.save()\n              }\n              //if all shoes links have been parsed then return\n              if (productCounter++ + 1 == products.length) {\n                callback(null, products);\n              }\n            });\n          }\n        });\n\n        stadiumGoodsScraper.getLink(shoe, function () {\n          if (++cbCounter == 3) {\n            Sneaker.countDocuments({\n              styleID: shoe.styleID\n            }, function (err, count) {\n              if (count <= 0) {\n                shoe.save()\n              }\n              //if all shoes links have been parsed then return\n              if (productCounter++ + 1 == products.length) {\n                callback(null, products);\n              }\n            });\n          }\n        });\n\n        goatScraper.getLink(shoe, function () {\n          if (++cbCounter == 3) {\n            Sneaker.countDocuments({\n              styleID: shoe.styleID\n            }, function (err, count) {\n              if (count <= 0) {\n                shoe.save()\n              }\n              //if all shoes links have been parsed then return\n              if (productCounter++ + 1 == products.length) {\n                callback(null, products);\n              }\n            });\n          }\n        });\n      });\n\n    });\n\n\n  }\n\n  getProductPrices  (shoeID, callback) {\n    const getPrices = (shoe) => {   \n      var cbCounter = 0;\n      stockXScraper.getPrices(shoe, function () {\n        cbCounter++;\n        if (cbCounter == 5) {\n          callback(null, shoe)\n        }\n      });\n      stadiumGoodsScraper.getPrices(shoe, function () {\n        cbCounter++;\n        if (cbCounter == 5) {\n          callback(null, shoe)\n        }\n\n      });\n      flightClubScraper.getPrices(shoe, function () {\n        cbCounter++;\n        if (cbCounter == 5) {\n          callback(null, shoe)\n        }\n\n      });\n      goatScraper.getPrices(shoe, function () {\n        cbCounter++;\n        if (cbCounter == 5) {\n          callback(null, shoe)\n        }\n      });\n      goatScraper.getPictures(shoe, function () {\n        cbCounter++;\n        if (cbCounter == 5) {\n          callback(null, shoe)\n        }\n      });\n    }\n    Sneaker.findOne({\n      styleID: shoeID\n    }, function (err, shoe) {\n      if (!shoe || err) {\n        console.log(new Error(\"Sneaker not found in database\"));\n        getProducts(shoeID, function (error, products) {\n          if (error) {\n            console.log(new Error(\"No Products Found\"));\n            callback(error, null);\n            return;\n          }\n          getPrices(products[0]);\n        });\n      } else {\n        getPrices(shoe);\n      }\n\n\n    });\n\n\n  };\n\n  findAll (callback)  {\n    Sneaker.find()\n      .then(sneaks => {\n        callback(null, sneaks);\n      }).catch(err => {\n        callback(err, null)\n      });\n  };\n\n  getMostPopular  (callback) {\n    getProducts(\"\", function (error, products) {\n      if (error) {\n        callback(error, null);\n      } else {\n        callback(null, products)\n      }\n    });\n  };\n}\n\n\nvar getProducts = function (keyword, callback) {\n  var productCounter = 0;\n  stockXScraper.getProductsAndInfo(keyword, function (error, products) {\n    if(error){\n      callback(error, null)\n    }\n     products.forEach( function (shoe) {\n      var cbCounter = 0;\n      flightClubScraper.getLink(shoe, function () {\n        if (++cbCounter == 3) {\n          Sneaker.countDocuments({\n            styleID: shoe.styleID\n          }, function (err, count) {\n            if (count <= 0) {\n              shoe.save()\n            }\n            //if all shoes links have been parsed then return\n            if (productCounter++ + 1 == products.length) {\n              callback(null, products);\n            }\n          });\n        }\n      });\n\n      stadiumGoodsScraper.getLink(shoe, function () {\n        if (++cbCounter == 3) {\n          Sneaker.countDocuments({\n            styleID: shoe.styleID\n          }, function (err, count) {\n            if (count <= 0) {\n              shoe.save()\n            }\n            //if all shoes links have been parsed then return\n            if (productCounter++ + 1 == products.length) {\n              callback(null, products);\n            }\n          });\n        }\n      });\n\n      goatScraper.getLink(shoe, function () {\n        if (++cbCounter == 3) {\n          Sneaker.countDocuments({\n            styleID: shoe.styleID\n          }, function (err, count) {\n            if (count <= 0) {\n              shoe.save()\n            }\n            //if all shoes links have been parsed then return\n            if (productCounter++ + 1 == products.length) {\n              callback(null, products);\n            }\n          });\n        }\n      });\n    });\n    \n  });\n}\n"]},"metadata":{},"sourceType":"script"}
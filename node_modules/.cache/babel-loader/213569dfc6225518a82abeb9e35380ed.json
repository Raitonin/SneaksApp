{"ast":null,"code":"const request = require('request');\n\nconst got = require('got');\n\nconst cheerio = require('cheerio');\n\nvar options = {\n  url: \"\",\n  body: \"\",\n  headers: {\n    'User-Agent': 'Sneaks-API',\n    'Content-Type': 'text/html'\n  }\n};\nmodule.exports = {\n  getLink: async function (shoe, callback) {\n    try {\n      const response = await got.post('https://graphql.stadiumgoods.com/graphql', {\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n          'Content-Type': 'application/json'\n        },\n        body: '{\"operationId\":\"sg-front/cached-a41eba558ae6325f072164477a24d3c2\",\"variables\":{\"initialSearchQuery\":\"' + shoe.styleID + '\",\"initialSort\":\"RELEVANCE\",\"filteringOnCategory\":false,\"filteringOnBrand\":false,\"filteringOnMensSizes\":false,\"filteringOnKidsSizes\":false,\"filteringOnWomensSizes\":false,\"filteringOnApparelSizes\":false,\"filteringOnGender\":false,\"filteringOnColor\":false,\"filteringOnPriceRange\":false},\"locale\":\"USA_USD\"}',\n        http2: true,\n        responseType: 'json'\n      });\n\n      if (response.body.data.configurableProducts.edges[0]) {\n        shoe.resellLinks.stadiumGoods = response.body.data.configurableProducts.edges[0].node.pdpUrl;\n        shoe.lowestResellPrice.stadiumGoods = Number(response.body.data.configurableProducts.edges[0].node.lowestPrice.value.formattedValue.replace(/[^0-9.-]+/g, \"\"));\n        callback();\n      } else {\n        callback(new Error(\"Product '\" + shoe.styleID + \"' not found on Stadium Goods'\"));\n      }\n    } catch (error) {\n      console.log(error);\n      callback();\n    }\n  },\n  getPrices: function (shoe, callback) {\n    if (!shoe.resellLinks.stadiumGoods) {\n      callback();\n    } else {\n      options.url = shoe.resellLinks.stadiumGoods;\n      let priceMap = {};\n      request.post(options, function getPriceMap(error, response, data) {\n        if (error) {\n          let err = new Error(\"Could not connect to Stadium Goods while searching '\", shoe.styleID, \"' Error: \", error);\n          console.log(err);\n          callback(err);\n        } else if (response.statusCode != 200) {\n          let err = new Error(\"Could not connect to Stadium Goods while searching '\", shoe.styleID, \"' -  Status Code: \", response.statusCode);\n          console.log(err);\n          callback(err);\n        } else {\n          const $ = cheerio.load(data);\n          $('.product-sizes__input').map(function (i, product) {\n            if ($(product).attr('data-stock') == 'true') {\n              var size = $(product).attr('data-size');\n\n              if (size[size.length - 1] == 'W') {\n                size = size.substring(0, size.length - 1);\n              }\n\n              priceMap[size] = parseInt($(product).attr('data-amount')) / 100;\n            }\n\n            if (i == $('.product-sizes__input').length - 1) {\n              shoe.resellPrices.stadiumGoods = priceMap;\n              callback();\n            }\n          });\n        }\n      });\n    }\n  }\n};","map":{"version":3,"sources":["/Users/dhruv/Sneaks/sneaks-website/node_modules/sneaks-api/scrapers/stadiumgoods-scraper.js"],"names":["request","require","got","cheerio","options","url","body","headers","module","exports","getLink","shoe","callback","response","post","styleID","http2","responseType","data","configurableProducts","edges","resellLinks","stadiumGoods","node","pdpUrl","lowestResellPrice","Number","lowestPrice","value","formattedValue","replace","Error","error","console","log","getPrices","priceMap","getPriceMap","err","statusCode","$","load","map","i","product","attr","size","length","substring","parseInt","resellPrices"],"mappings":"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","sourcesContent":["const request = require('request');\nconst got = require('got');\nconst cheerio = require('cheerio');\n\nvar options = {\n    url: \"\",\n    body: \"\",\n    headers: {\n        'User-Agent': 'Sneaks-API',\n        'Content-Type': 'text/html',\n    }\n};\nmodule.exports = {\n    getLink: async function (shoe, callback) {\n        try {\n            \n            const response = await got.post('https://graphql.stadiumgoods.com/graphql', {\n                headers: {\n                    'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_2) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.4 Safari/605.1.15',\n                    'Content-Type': 'application/json'\n\n                },\n                body: '{\"operationId\":\"sg-front/cached-a41eba558ae6325f072164477a24d3c2\",\"variables\":{\"initialSearchQuery\":\"' + shoe.styleID + '\",\"initialSort\":\"RELEVANCE\",\"filteringOnCategory\":false,\"filteringOnBrand\":false,\"filteringOnMensSizes\":false,\"filteringOnKidsSizes\":false,\"filteringOnWomensSizes\":false,\"filteringOnApparelSizes\":false,\"filteringOnGender\":false,\"filteringOnColor\":false,\"filteringOnPriceRange\":false},\"locale\":\"USA_USD\"}',\n                http2: true,\n                responseType: 'json'\n            });\n            if (response.body.data.configurableProducts.edges[0]) {\n                shoe.resellLinks.stadiumGoods = response.body.data.configurableProducts.edges[0].node.pdpUrl;\n                shoe.lowestResellPrice.stadiumGoods = Number(response.body.data.configurableProducts.edges[0].node.lowestPrice.value.formattedValue.replace(/[^0-9.-]+/g, \"\"));\n             \n                callback();\n            } else {\n                callback(new Error(\"Product '\" + shoe.styleID + \"' not found on Stadium Goods'\"));\n            }\n        } catch (error) {\n            console.log(error);\n            callback();\n        }\n    },\n\n    getPrices: function (shoe, callback) {\n        if (!shoe.resellLinks.stadiumGoods) {\n            callback()\n        } else {\n            options.url = shoe.resellLinks.stadiumGoods;\n            let priceMap = {};\n            request.post(options,\n                function getPriceMap(error, response, data) {\n                    if (error) {\n                        let err = new Error(\"Could not connect to Stadium Goods while searching '\", shoe.styleID, \"' Error: \", error)\n                        console.log(err);\n                        callback(err)\n                    } else if (response.statusCode != 200) {\n                        let err = new Error(\"Could not connect to Stadium Goods while searching '\", shoe.styleID, \"' -  Status Code: \", response.statusCode)\n                        console.log(err);\n                        callback(err)\n                    } else {\n                        const $ = cheerio.load(data);\n                        $('.product-sizes__input').map(function (i, product) {\n                            if ($(product).attr('data-stock') == 'true') {\n                                var size = $(product).attr('data-size');\n                                if(size[size.length-1]=='W'){\n                                    size = size.substring(0, size.length - 1);\n                                }\n                                priceMap[size] = parseInt($(product).attr('data-amount')) / 100;\n                            }\n                            if (i == $('.product-sizes__input').length - 1) {\n                                shoe.resellPrices.stadiumGoods = priceMap;\n                                callback();\n                            }\n                        });\n                    }\n                });\n        }\n    }\n}"]},"metadata":{},"sourceType":"script"}